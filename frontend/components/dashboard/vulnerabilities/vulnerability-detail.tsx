
// // components/dashboard/vulnerability-detail.tsx (UPDATED - simplified team actions)
// "use client";

// import { useEffect, useState } from "react";
// import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
// import { Button } from "@/components/ui/button";
// import { Badge } from "@/components/ui/badge";
// import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
// import { Alert, AlertDescription } from "@/components/ui/alert";
// import {
//   ChevronLeft,
//   AlertTriangle,
//   FileCode,
//   Lightbulb,
//   CheckCircle2,
//   ExternalLink,
//   Copy,
//   Check,
//   Loader2,
//   Shield,
//   Zap,
//   Clock,
//   AlertCircle,
// } from "lucide-react";
// import Link from "next/link";
// import { useSearchParams } from "next/navigation";
// import { vulnerabilitiesApi, type VulnerabilitySAST, type VulnerabilityAISuspected } from "@/lib/api/vulnerabilities";
// import { repositoriesApi, type Repository } from "@/lib/api/repositories";

// export function VulnerabilityDetail({
//   repoName,
//   vulnerabilityId,
// }: {
//   repoName: string;
//   vulnerabilityId: string;
// }) {
//   const searchParams = useSearchParams();
//   const type = (searchParams?.get("type") as "sast" | "ai_suspected") || "sast";

//   const [vulnerability, setVulnerability] = useState<
//     VulnerabilitySAST | VulnerabilityAISuspected | null
//   >(null);
//   const [repository, setRepository] = useState<Repository | null>(null);
//   const [loading, setLoading] = useState(true);
//   const [error, setError] = useState<string | null>(null);
//   const [copied, setCopied] = useState(false);

//   useEffect(() => {
//     loadData();
//   }, [vulnerabilityId, type]);

//   const loadData = async () => {
//     try {
//       setLoading(true);
//       setError(null);

//       const vulnData = await vulnerabilitiesApi.getById(vulnerabilityId, type);
//       setVulnerability(vulnData);

//       const repoData = await repositoriesApi.getById(vulnData.repository_id);
//       setRepository(repoData);
//     } catch (err: any) {
//       setError(err.message || "Failed to load vulnerability");
//     } finally {
//       setLoading(false);
//     }
//   };

//   const handleCopyCode = (code: string) => {
//     navigator.clipboard.writeText(code);
//     setCopied(true);
//     setTimeout(() => setCopied(false), 2000);
//   };

//   const formatDate = (dateString: string) => {
//     const date = new Date(dateString);
//     const now = new Date();
//     const diff = now.getTime() - date.getTime();
//     const hours = Math.floor(diff / (1000 * 60 * 60));

//     if (hours < 1) return "Just now";
//     if (hours < 24) return `${hours} hours ago`;
//     return date.toLocaleDateString();
//   };

//   if (loading) {
//     return (
//       <div className="flex items-center justify-center min-h-[400px]">
//         <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
//       </div>
//     );
//   }

//   if (error || !vulnerability) {
//     return (
//       <div className="space-y-6">
//         <Button variant="ghost" size="sm" asChild>
//           <Link href={`/dashboard/repos/${repoName}`}>
//             <ChevronLeft className="mr-2 h-4 w-4" />
//             Back to {repoName}
//           </Link>
//         </Button>
//         <Alert variant="destructive">
//           <AlertCircle className="h-4 w-4" />
//           <AlertDescription>{error || "Vulnerability not found"}</AlertDescription>
//         </Alert>
//       </div>
//     );
//   }

//   const isSAST = type === "sast";
//   const title = isSAST
//     ? (vulnerability as VulnerabilitySAST).title
//     : (vulnerability as VulnerabilityAISuspected).category;
//   const file = isSAST
//     ? (vulnerability as VulnerabilitySAST).file
//     : (vulnerability as VulnerabilityAISuspected).file_path;
//   const line = isSAST
//     ? (vulnerability as VulnerabilitySAST).line
//     : (vulnerability as VulnerabilityAISuspected).line_start;

//   return (
//     <div className="space-y-6">
//       {/* Header */}
//       <div>
//         <Button variant="ghost" size="sm" className="mb-4" asChild>
//           <Link href={`/dashboard/repos/${repoName}`}>
//             <ChevronLeft className="mr-2 h-4 w-4" />
//             Back to {repository?.name || repoName}
//           </Link>
//         </Button>

//         <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
//           <div className="flex-1">
//             <div className="flex items-center gap-2 mb-3 flex-wrap">
//               <Badge
//                 variant={vulnerability.status === "open" ? "destructive" : "secondary"}
//                 className="text-sm"
//               >
//                 {vulnerability.severity}
//               </Badge>
//               <Badge variant="outline" className="flex items-center gap-1">
//                 {isSAST ? (
//                   <>
//                     <Shield className="h-3 w-3" />
//                     SAST Verified
//                   </>
//                 ) : (
//                   <>
//                     <Zap className="h-3 w-3" />
//                     AI Suspected
//                   </>
//                 )}
//               </Badge>
//               {isSAST && (vulnerability as VulnerabilitySAST).cwe && (
//                 <Badge variant="outline">{(vulnerability as VulnerabilitySAST).cwe}</Badge>
//               )}
//             </div>
//             <h1 className="text-3xl font-bold tracking-tight mb-2">{title}</h1>
//             <p className="text-muted-foreground">
//               Found in <code className="text-sm bg-muted px-2 py-0.5 rounded">{file}:{line}</code>
//             </p>
//           </div>
//           <div className="flex gap-2">
//             <Badge variant="outline">{vulnerability.status}</Badge>
//           </div>
//         </div>
//       </div>

//       {/* Main Content */}
//       <div className="grid lg:grid-cols-3 gap-6">
//         {/* Left Column - Details */}
//         <div className="lg:col-span-2 space-y-6">
//           <Card>
//             <CardHeader>
//               <CardTitle className="flex items-center gap-2">
//                 <AlertTriangle className="h-5 w-5 text-destructive" />
//                 Vulnerability Details
//               </CardTitle>
//             </CardHeader>
//             <CardContent className="space-y-4">
//               {isSAST ? (
//                 <>
//                   <div>
//                     <h3 className="font-semibold mb-2">Description</h3>
//                     <p className="text-sm text-muted-foreground leading-relaxed">
//                       {(vulnerability as VulnerabilitySAST).description ||
//                         (vulnerability as VulnerabilitySAST).message}
//                     </p>
//                   </div>

//                   {(vulnerability as VulnerabilitySAST).ai_explanation && (
//                     <div>
//                       <h3 className="font-semibold mb-2">AI Analysis</h3>
//                       <p className="text-sm text-muted-foreground leading-relaxed">
//                         {(vulnerability as VulnerabilitySAST).ai_explanation}
//                       </p>
//                     </div>
//                   )}

//                   {(vulnerability as VulnerabilitySAST).ai_severity_reasoning && (
//                     <div>
//                       <h3 className="font-semibold mb-2">Severity Reasoning</h3>
//                       <p className="text-sm text-muted-foreground leading-relaxed">
//                         {(vulnerability as VulnerabilitySAST).ai_severity_reasoning}
//                       </p>
//                     </div>
//                   )}

//                   {(vulnerability as VulnerabilitySAST).ai_remediation && (
//                     <div>
//                       <h3 className="font-semibold mb-2">Remediation Steps</h3>
//                       <p className="text-sm text-muted-foreground leading-relaxed">
//                         {(vulnerability as VulnerabilitySAST).ai_remediation}
//                       </p>
//                     </div>
//                   )}
//                 </>
//               ) : (
//                 <>
//                   <div>
//                     <h3 className="font-semibold mb-2">AI Analysis</h3>
//                     <p className="text-sm text-muted-foreground leading-relaxed">
//                       {(vulnerability as VulnerabilityAISuspected).reason}
//                     </p>
//                   </div>

//                   {(vulnerability as VulnerabilityAISuspected).recommended_fix && (
//                     <div>
//                       <h3 className="font-semibold mb-2">Recommended Fix</h3>
//                       <p className="text-sm text-muted-foreground leading-relaxed">
//                         {(vulnerability as VulnerabilityAISuspected).recommended_fix}
//                       </p>
//                     </div>
//                   )}

//                   <div>
//                     <h3 className="font-semibold mb-2">Confidence Score</h3>
//                     <div className="flex items-center gap-2">
//                       <div className="flex-1 h-2 bg-muted rounded-full overflow-hidden">
//                         <div
//                           className="h-full bg-primary transition-all"
//                           style={{
//                             width: `${(vulnerability as VulnerabilityAISuspected).confidence_score * 100}%`,
//                           }}
//                         />
//                       </div>
//                       <span className="text-sm font-medium">
//                         {Math.round(
//                           (vulnerability as VulnerabilityAISuspected).confidence_score * 100
//                         )}
//                         %
//                       </span>
//                     </div>
//                     <p className="text-xs text-muted-foreground mt-2">
//                       This score indicates how confident the AI is about this finding
//                     </p>
//                   </div>
//                 </>
//               )}
//             </CardContent>
//           </Card>

//           {/* Code Analysis */}
//           {vulnerability.code_snippet && (
//             <Card>
//               <CardHeader>
//                 <CardTitle className="flex items-center gap-2">
//                   <FileCode className="h-5 w-5" />
//                   Code Analysis
//                 </CardTitle>
//               </CardHeader>
//               <CardContent>
//                 <Tabs defaultValue="vulnerable">
//                   <TabsList className="grid w-full grid-cols-2">
//                     <TabsTrigger value="vulnerable">Vulnerable Code</TabsTrigger>
//                     {isSAST && (vulnerability as VulnerabilitySAST).ai_patch && (
//                       <TabsTrigger value="fixed">AI Fix Suggestion</TabsTrigger>
//                     )}
//                   </TabsList>
//                   <TabsContent value="vulnerable" className="space-y-4">
//                     <div className="relative">
//                       <pre className="bg-muted p-4 rounded-lg overflow-x-auto text-sm border border-destructive/30">
//                         <code>{vulnerability.code_snippet}</code>
//                       </pre>
//                       <Button
//                         size="sm"
//                         variant="ghost"
//                         className="absolute top-2 right-2"
//                         onClick={() => handleCopyCode(vulnerability.code_snippet!)}
//                       >
//                         {copied ? <Check className="h-4 w-4" /> : <Copy className="h-4 w-4" />}
//                       </Button>
//                     </div>
//                   </TabsContent>
//                   {isSAST && (vulnerability as VulnerabilitySAST).ai_patch && (
//                     <TabsContent value="fixed" className="space-y-4">
//                       <div className="relative">
//                         <pre className="bg-muted p-4 rounded-lg overflow-x-auto text-sm border border-green-500/30">
//                           <code>{(vulnerability as VulnerabilitySAST).ai_patch}</code>
//                         </pre>
//                         <Button
//                           size="sm"
//                           variant="ghost"
//                           className="absolute top-2 right-2"
//                           onClick={() =>
//                             handleCopyCode((vulnerability as VulnerabilitySAST).ai_patch!)
//                           }
//                         >
//                           {copied ? <Check className="h-4 w-4" /> : <Copy className="h-4 w-4" />}
//                         </Button>
//                       </div>
//                       <div className="bg-green-50 dark:bg-green-950/30 border border-green-500/30 rounded-lg p-4">
//                         <div className="flex items-start gap-2">
//                           <Lightbulb className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
//                           <div>
//                             <p className="text-sm font-medium text-green-700 dark:text-green-400 mb-1">
//                               AI-Generated Fix Suggestion
//                             </p>
//                             <p className="text-sm text-foreground/80">
//                               This solution has been analyzed and recommended by AI to address the
//                               security vulnerability.
//                             </p>
//                           </div>
//                         </div>
//                       </div>
//                     </TabsContent>
//                   )}
//                 </Tabs>
//               </CardContent>
//             </Card>
//           )}
//         </div>

//         {/* Right Column - Metadata */}
//         <div className="space-y-6">
//           <Card>
//             <CardHeader>
//               <CardTitle>Metadata</CardTitle>
//             </CardHeader>
//             <CardContent className="space-y-4">
//               <div>
//                 <div className="text-sm text-muted-foreground mb-1">Severity</div>
//                 <Badge variant={vulnerability.status === "open" ? "destructive" : "secondary"}>
//                   {vulnerability.severity}
//                 </Badge>
//               </div>

//               {isSAST && (vulnerability as VulnerabilitySAST).cwe && (
//                 <div>
//                   <div className="text-sm text-muted-foreground mb-1">CWE ID</div>
//                   <div className="text-sm font-medium">{(vulnerability as VulnerabilitySAST).cwe}</div>
//                 </div>
//               )}

//               <div>
//                 <div className="text-sm text-muted-foreground mb-1">Status</div>
//                 <Badge variant="outline">{vulnerability.status}</Badge>
//               </div>

//               <div>
//                 <div className="text-sm text-muted-foreground mb-1">Detected</div>
//                 <div className="text-sm font-medium">{formatDate(vulnerability.detected_at)}</div>
//               </div>

//               <div>
//                 <div className="text-sm text-muted-foreground mb-1">File Location</div>
//                 <code className="text-xs bg-muted px-2 py-1 rounded block">
//                   {file}:{line}
//                 </code>
//               </div>

//               <div>
//                 <div className="text-sm text-muted-foreground mb-1">Type</div>
//                 <Badge variant="outline" className="flex items-center gap-1 w-fit">
//                   {isSAST ? (
//                     <>
//                       <Shield className="h-3 w-3" />
//                       SAST Verified
//                     </>
//                   ) : (
//                     <>
//                       <Zap className="h-3 w-3" />
//                       AI Suspected
//                     </>
//                   )}
//                 </Badge>
//               </div>
//             </CardContent>
//           </Card>

//           <Card>
//             <CardHeader>
//               <CardTitle>Actions</CardTitle>
//             </CardHeader>
//             <CardContent className="space-y-2">
//               <Button className="w-full" variant="outline" asChild>
//                 <a href={repository?.url} target="_blank" rel="noopener noreferrer">
//                   <ExternalLink className="mr-2 h-4 w-4" />
//                   View in Repository
//                 </a>
//               </Button>
//               <Alert>
//                 <AlertCircle className="h-4 w-4" />
//                 <AlertDescription className="text-xs">
//                   Team collaboration features (assign, create issue) coming soon
//                 </AlertDescription>
//               </Alert>
//             </CardContent>
//           </Card>
//         </div>
//       </div>
//     </div>
//   );
// }